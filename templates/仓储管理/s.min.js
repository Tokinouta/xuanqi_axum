function copyStringToClipboard(e){try{document.body.removeChild(textarea_copy_el)}catch(e){console.error(e)}textarea_copy_el=document.createElement("textarea"),textarea_copy_el.value=e,textarea_copy_el.setAttribute("readonly",""),textarea_copy_el.style.position="absolute",textarea_copy_el.style.left="-9999px",document.body.appendChild(textarea_copy_el),textarea_copy_el.select(),document.execCommand("copy")}daysMap=new Map,editor=null,isLoading=!1,cancelUploadFunc=void 0,app={entershoulddefault:!1},前缀str='<html lang=\'zh\'>\n<head>\n<meta charset="UTF-8">\n<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4.5.3/dist/css/bootstrap.min.css"\n  integrity="sha256-93wNFzm2GO3EoByj9rKZCwGjAJAwr0nujPaOgwUt8ZQ=" crossorigin="anonymous">\n<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-vue@2.21.2/dist/bootstrap-vue.min.css"\n  integrity="sha256-cAyk5KZc7P6j7j/uL7MOoN4PRsZYp+BN9yo03Y6Qk38=" crossorigin="anonymous">\n<style>*{font-family:\'Sarasa Term SC\'}body{white-space:pre-wrap}</style>\n</head>\n<body><div id="app"><!-- vue instance -->',中缀str='<!-- vue instance end --></div></body>\n<script src="https://cdn.jsdelivr.net/npm/vue@2.6.14/dist/vue.min.js"\n  integrity="sha256-kXTEJcRFN330VirZFl6gj9+UM6gIKW195fYZeR3xDhc=" crossorigin="anonymous"></script>\n<script src="https://cdn.jsdelivr.net/npm/bootstrap-vue@2.21.2/dist/bootstrap-vue.min.js"\n  integrity="sha256-duDNIhfVrUK7HB/57nPLxN/j92aM3rhTUFzVI/H5ex8=" crossorigin="anonymous"></script>\n<script>',后缀str="</script>\n</html>",上次刷新的时间=new Date("1995-12-17T03:24:00"),本次input的时间=new Date("1995-12-17T03:24:00");var getProgText=function(e){for(var t=document.querySelector(e),a=t.childNodes,n=a.length-1;n>=0;n--)"BR"==a[n].tagName&&t.removeChild(a[n]);return t.innerText},cumulativeOffset=function(e){var t=0,a=0;do{t+=e.offsetTop||0,a+=e.offsetLeft||0,e=e.offsetParent}while(e);return{top:t,left:a}},app=new Vue({el:"#app",data:{isLoggedIn:"",weekDayMap:["周日","周一","周二","周三","周四","周五","周六"],allowTypeSelection:!0,finishedTimeAsc:!1,fullitems:[],warehouses:[""],search_result:[],busy_connecting_backend:!1,isQueryingBackend:!1,entershoulddefault:!1,ConfirmText:"",ConfirmResult:null,ConfirmPromiseResolve:null,page_history:1,query_txt:"",resnumber:888,edittgtitem:{type:"default","名称":"垃圾堆","描述":"垃圾堆","数量":1,"内容":[]},edittgtfile:["","","","attachment"],fileUploaded:!1,uploadPercentCompleted:0,focused_elem_stack:[],show_search_result_mode:!1,currentDraggedElem:null,currentDragTarget:null,consoleCmd:"",backupList:[],newBackupName:"",showSidebar:!1,showBackupSidebar:!1,previewImgURL:"",loadedJsLibs:{hljs:!1,kindeditor:!1},tmpProgType:"clip",tmpProgText:"",tmpProgTextRealtime:"",tmpProgText2:"",tmpProgText2Realtime:"",tmpProgLang:"Language-python",tmpProgLangUserInput:"go",editorText:"",batchSentences:"",copyPaste1:""},mounted(){window.history.pushState({page:1},"",""),"初始化URLBase-"==this.CurWarehouse.slice(0,11)?(this.CurWarehouse=this.CurWarehouse.slice(11),this.getitems([])):(this.CurWarehouse="当前focus数据结构",this.getitems([])),this.getwarehouses()},methods:{dragstartF:function(e,t){document.getElementById("dragCursor").style.display="block",this.currentDraggedElem=t},dragenterF:function(e,t){for(e.stopPropagation(),curelem=e.target;!curelem.classList.contains("bdispl")&&!curelem.classList.contains("bbtmbtn");)curelem=curelem.parentElement;var a=document.getElementById("dragCursor");curelem.parentElement.insertBefore(a,curelem),this.currentDragTarget=t.ind.concat()},dragleaveF:function(e,t){},dragenterFLast:function(e,t){for(e.stopPropagation(),curelem=e.target;!curelem.classList.contains("bdispl")&&!curelem.classList.contains("bbtmbtn");)curelem=curelem.parentElement;var a=document.getElementById("dragCursor");curelem.parentElement.insertBefore(a,curelem),t.ind?this.currentDragTarget=t.ind.concat().concat([t.内容.length]):this.currentDragTarget=[this.fullitems.length].concat()},dragleaveFLast:function(e,t){},dropF:function(e,item){var cur=document.getElementById("dragCursor");if(document.getElementById("dragCursorMark").parentElement.insertBefore(cur,document.getElementById("dragCursorMark")),cur.style.display="none",console.log(item.ind),console.log(this.currentDragTarget),this.currentDragTarget.length>=item.ind.length){issub=!0;for(let e=0;e<item.ind.length;e++)this.currentDragTarget[e]!=item.ind[e]&&(issub=!1);if(issub&&this.currentDragTarget.length>item.ind.length)return void window.alert("不能将物体移动到其内部的子节点中！当前移动操作已取消，请重试。");issub=!0;for(let e=0;e<item.ind.length-1;e++)this.currentDragTarget[e]!=item.ind[e]&&(issub=!1);issub&&this.currentDragTarget[item.ind.length-1]>item.ind[item.ind.length-1]&&this.currentDragTarget[item.ind.length-1]--}console.log("newtarget",this.currentDragTarget),axios.post("/storageManager/move-items",{src:item.ind,tgt:this.currentDragTarget,warehs:this.CurWarehouse,baseInd:this.baseInd}).then(function(response){resptext=response.data,resvals=eval(resptext),target=app.fullitems;for(const e of item.ind.slice(0,-1))target=target[e].内容;if(被移动物拷贝=JSON.parse(JSON.stringify(target[item.ind[item.ind.length-1]])),app.$delete(target,item.ind[item.ind.length-1]),target=app.fullitems,level=item.ind.slice(0,-1),0!=level.length){for(const e of level.slice(0,-1))target=target[e].内容;target[level[level.length-1]].内容=resvals[0];try{target=app.fullitems;for(const e of app.currentDragTarget.slice(0,-1))target=target[e].内容;if(target.splice(app.currentDragTarget[app.currentDragTarget.length-1],0,被移动物拷贝),target=app.fullitems,level=app.currentDragTarget.slice(0,-1),0==level.length)return void(app.fullitems=resvals[1]);for(const e of level.slice(0,-1))target=target[e].内容;target[level[level.length-1]].内容=resvals[1]}catch(e){}app.$forceUpdate()}else app.fullitems=resvals[0]}).catch(function(e){console.log(e),window.alert("获取后端信息出错，为了保证数据结构不受损害，请刷新页面！！")}),app.$forceUpdate()},bdisplhover:function(e){for(e.stopPropagation(),tmpstack=[],curelem=e.target;curelem.parentElement.parentElement.classList.contains("bdispl");)curelem=curelem.parentElement.parentElement,tmpstack.push(curelem);if(tmpstack.reverse(),!(this.focused_elem_stack.length>tmpstack.length)){try{this.focused_elem_stack.forEach(e=>{e.className=e.className.replace(" TheFocusedItem","")})}catch(e){}this.focused_elem_stack=tmpstack,this.focused_elem_stack.forEach(e=>{e.className=e.className.replace(" TheFocusedItem","")}),this.focused_elem_stack.push(e.target),e.target.className=e.target.className+" TheFocusedItem"}},bdisplleave:function(e){var t=this.focused_elem_stack.pop();t&&(t.className=t.className.replace(" TheFocusedItem",""));var a=this.focused_elem_stack.pop();a&&(this.focused_elem_stack.push(a),a.className=a.className+" TheFocusedItem"),e.stopPropagation()},toggleExpand:function(e){e.expandDesc=!e.expandDesc},login:function(){if(this.signup_username.length<2)window.alert("用户名长度不得小于2位，请重新输入！");else if(this.signup_password.length<5)window.alert("密码长度不得小于5位，请重新输入！");else{console.log("log in.");var e=new jsSHA("SHA-256","TEXT",{numRounds:1});e.update(this.signup_username+this.signup_password+"salter2333");var t=e.getHash("HEX");console.log("generated login auth:",t,"connecting to backend..."),this.busy_connecting_backend=!0,axios.post("/storageManager/log-in",{username:this.signup_username,auth:t}).then(function(e){if(login_state=e.data,app.busy_connecting_backend=!1,"ok"!=login_state)return"already_logged_in"==login_state?void window.alert("当前用户已经登录。出现此提示应为前端错误，请您刷新网页。"):"nosignup"==login_state?void window.alert("当前用户尚未注册。请您先注册哟~"):void window.alert("登录失败，应是用户名或密码错误。请检查输入~\n未注册需先注册。");app.$bvModal.hide("bv-modal-login"),app.isLoggedIn=!0,window.alert("登录成功！")}).catch(function(e){console.log(e)})}},logout:function(){console.log("log out."),axios.post("/storageManager/log-out",{}).then(function(e){app.isLoggedIn=!1,window.alert("退出登录成功！")}).catch(function(e){console.log(e)})},getitems:function(level){axios.post("/storageManager/get-items",{level:level,warehs:this.CurWarehouse,baseInd:this.baseInd}).then(function(response){if(resptext=response.data,0==level.length)return app.fullitems=eval(resptext),void(app.isTimeManagement&&app.TimeSortAsc());target=app.fullitems;for(const e of level.slice(0,-1))target=target[e].内容;target[level[level.length-1]].内容=eval(resptext),console.log(target),app.$forceUpdate()}).catch(function(e){console.log(e),window.alert("您可能未登录哟~或获取后端信息出错，为了保证数据结构不受损害，请刷新页面！！")})},prepareBackupSidebar:function(){this.showBackupSidebar=!0,axios.post("/storageManager/get-backup-list",{}).then(function(response){resp=eval(response.data),app.backupList=resp}).catch(function(e){console.log(e),window.alert("恢复出错，请尽量不刷新页面、然后重试！！")})},restoreBackup:function(e){window.confirm("！！！此操作不可撤销！！！请确认操作。此外，您的操作将解压全部用户的备份、但只更新您的数据，这是程序的bug，如果想要节省恢复成本，需要程序员修改备份逻辑！")&&axios.post("/storageManager/restore-backup",{file:e}).then(function(e){window.alert("已完成备份，请检查！"),app.showBackupSidebar=!1,app.showSidebar=!1})},removeBackup:function(backup){window.confirm("！！！此操作不可撤销！！！请确认操作。")&&axios.post("/storageManager/remove-backup",{file:backup}).then(function(response){window.alert("已删除备份，请检查！"),axios.post("/storageManager/get-backup-list",{}).then(function(response){resp=eval(response.data),app.backupList=resp})})},createNewBackup:function(){window.confirm("您确定要以【"+this.newBackupName+"】为名称创建备份吗~ （多用户逻辑不完善，请即联系程序员修改）")&&axios.post("/storageManager/create-backup",{name:this.newBackupName}).then(function(e){window.alert("已完成备份，请检查！"),app.showBackupSidebar=!1,app.showSidebar=!1})},clearTemp:function(){axios.post("/storageManager/clear-temp",{action:"query"}).then(function(response){resp=eval(response.data),window.confirm("当前temp文件夹中共有"+resp+"个文件。请确认操作。")&&axios.post("/storageManager/clear-temp",{action:"clean"}).then(function(e){window.alert("已清理temp文件夹！")})})},getwarehouses:function(level){axios.post("/storageManager/get-warehouses",{}).then(function(response){resp=eval(response.data),app.warehouses=resp.warehouses,"当前focus数据结构"!=app.CurWarehouse||(app.CurWarehouse=resp.CurWarehouse)})},executeCmdCommand:function(){tgtind=this.warehouses.indexOf(this.consoleCmd),-1!=tgtind?this.warehouseFocus(tgtind):window.alert("定位库失败，请确认库名称是否正确！")},rmWarehouse:function(e){window.confirm("！！！此操作不可撤销！！！请确认操作")&&axios.post("/storageManager/remove-warehouse",{ind:e}).then(function(e){window.alert("删除成功"),app.getwarehouses()})},warehouseFocus:function(e){axios.post("/storageManager/focus-warehouse",{ind:e}).then(function(t){app.CurWarehouse=app.warehouses[e],app.showSidebar=!1,app.$bvToast.toast("更改 warehouse focus 导航成功！",{title:"导航成功！",autoHideDelay:3e3,appendToast:!0,variant:"primary",toaster:"b-toaster-bottom-right"}),app.baseInd=[],app.upperDirInfo=null,app.isTimeManagement="事件管理ToDo"==app.CurWarehouse,app.getitems([]),app.show_search_result_mode=!1})},addWarehouse:function(){for(newname="";""==newname||/[.:/\\ ~><?]/g.test(newname)||-1!=this.warehouses.indexOf(newname);)newname=prompt("请输入新库的名称（如果重复出现提示框，说明之前输入的包含非法字符）：");axios.post("/storageManager/add-warehouse",{name:newname}).then(function(e){window.alert("添加成功"),app.getwarehouses()})},renameWarehouse:function(e){for(newname="";""==newname||/[.:/\\ ~><?]/g.test(newname)||-1!=this.warehouses.indexOf(newname);)newname=prompt("请输入这个库的新名称（如果重复出现提示框，说明之前输入的包含非法字符，或命名与已有库重复）：");axios.post("/storageManager/rename-warehouse",{ind:e,name:newname}).then(function(e){window.alert("改名成功"),app.getwarehouses()})},moveUpWarehouse:function(e){axios.post("/storageManager/moveup-warehouse",{ind:e}).then(function(e){app.getwarehouses()})},moveDownWarehouse:function(e){axios.post("/storageManager/movedown-warehouse",{ind:e}).then(function(e){app.getwarehouses()})},recursivelyGetItems:function(e){this.$bvToast.toast("请注意不要急于操作。本次导航预计耗时："+(.6+.2*e.length)+"秒。",{title:"⚠️正在导航，请注意不要急于操作！",autoHideDelay:4e3,appendToast:!0,variant:"danger",toaster:"b-toaster-bottom-right"});for(let t=0;t<e.length;t++)setTimeout(()=>{app.getitems(e.slice(0,t+1))},200*t);return setTimeout(()=>{if(0!=e.length){target=app.fullitems;for(const t of e.slice(0,-1))target=target[t].内容;console.log(target),target[e[e.length-1]].isfocus=!0,app.show_search_result_mode=!1,app.$forceUpdate(),setTimeout(()=>{window.scrollTo(0,cumulativeOffset(document.getElementById("resultScrollMark")).top-160),app.$forceUpdate(),setTimeout(()=>{delete target[e[e.length-1]].isfocus,app.$forceUpdate()},1500)},200)}},400+200*e.length),.6+.2*e.length},deleteitems:function(level){window.confirm("！warning！\n请确认删除操作，因为删除操作将会移除该项所包含的所有内容，包括文件、rtf、代码等等。是否确认删除该项？？？")&&axios.post("/storageManager/delete-items",{level:level,warehs:this.CurWarehouse,baseInd:this.baseInd}).then(function(response){if(resptext=response.data,0!=level.length){target=app.fullitems;for(const e of level.slice(0,-1))target=target[e].内容;if(app.$delete(target,level[level.length-1]),app.$forceUpdate(),1!=level.length){target=app.fullitems;for(const e of level.slice(0,-1))target=target[e].内容;targetnewind=eval(resptext);for(let e=0;e<targetnewind.length;e++)target[e].ind=targetnewind[e].ind;app.$bvToast.toast("已删除~",{title:"此操作不可撤回，若想撤销需要重新输入相关信息。",autoHideDelay:2500,appendToast:!0,variant:"danger",solid:!0,toaster:"b-toaster-bottom-right"})}else{targetnewind=eval(resptext);for(let e=0;e<targetnewind.length;e++)app.fullitems[e].ind=targetnewind[e].ind}}else app.fullitems=[]}).catch(function(e){console.log(e)})},additems:function(e){target=app.fullitems;for(const t of e)target=target[t].内容;defaultstuff={ind:e.concat([target.length]),type:"default","名称":"新建物品[默认值]","描述":"请输入该物品的描述！","词向量描述":["[<新物品>]"],"句向量描述":[],"数量":1,"内容":[],files:[]},target.push(defaultstuff),axios.post("/storageManager/add-items",{level:e,stuff:defaultstuff,warehs:this.CurWarehouse,baseInd:this.baseInd}).then(function(e){app.$bvToast.toast("已添加新物品~请编辑物品属性哟。",{title:"已添加新物品~",autoHideDelay:2500,appendToast:!0,variant:"info",solid:!0,toaster:"b-toaster-bottom-right"});var t=new Date;currentTimeZoneOffsetInHours=-t.getTimezoneOffset()/60;var a=new Date;a.setHours(a.getHours()+currentTimeZoneOffsetInHours);var n=a.toISOString();app.edittgtitem.modify=app.edittgtitem.setup=n.slice(0,10)+" "+n.slice(11,19),app.edittarget(defaultstuff.ind)}).catch(function(e){console.log(e)}),delete defaultstuff.内容},edittarget:function(e){if(console.log("edittarget",e),0!=e.length){target=app.fullitems;for(const t of e.slice(0,-1))target=target[t].内容;this.edittgtitem=target[e[e.length-1]];var t=this.edittgtitem,a=new Date;currentTimeZoneOffsetInHours=-a.getTimezoneOffset()/60;var n=new Date;n.setHours(n.getHours()+currentTimeZoneOffsetInHours);var o=n.toISOString();this.allowTypeSelection=!0,this.isTimeManagement&&e.length<=1&&(Vue.set(t,"type","事件Event"),this.allowTypeSelection=!1),t.截止日期||Vue.set(t,"截止日期",o.slice(0,10)),t.截止时间||Vue.set(t,"截止时间","17:00"),t.重复数||Vue.set(t,"重复数",0),t.重复间隔||Vue.set(t,"重复间隔","天"),t.已完成||Vue.set(t,"已完成","未完成"),t.数量||Vue.set(t,"数量",1),this.$bvModal.show("edittargetmodal")}else this.edittgtitem=this.fullitems},saveedittgt:function(){var e=document.getElementById("edittgtitem词向量描述"),t=[];for(let a=0;a<e.childNodes.length;a++){const n=e.childNodes[a];t.push(n.querySelector("input").value)}this.edittgtitem.词向量描述=t;var a=document.getElementById("edittgtitem句向量描述"),n=[];for(let e=0;e<a.childNodes.length;e++){const t=a.childNodes[e];n.push(t.querySelector("textarea").value)}this.edittgtitem.句向量描述=n,axios.post("/storageManager/save-items",{level:this.edittgtitem.ind,stuff:this.edittgtitem,warehs:this.CurWarehouse,baseInd:this.baseInd}).then(function(e){resptext=e.data,console.log(resptext);let t=new Date,a=-t.getTimezoneOffset()/60;var n=new Date;n.setHours(n.getHours()+a);var o=n.toISOString();app.edittgtitem.modify=o.slice(0,10)+" "+o.slice(11,19),resptext.startsWith("Exception")&&window.confirm("您输入的公式有误，或词语不支持。请重新输入词向量表示，否则搜索效果不佳！报错代码："+resptext)&&app.$bvModal.show("edittargetmodal"),app.$bvToast.toast("已保存位于程序数据结构["+app.edittgtitem.ind+"]处的信息~",{title:"已保存~",autoHideDelay:2500,appendToast:!0,variant:"info",solid:!0,toaster:"b-toaster-bottom-right"}),1==app.edittgtitem.ind.length&&app.isTimeManagement&&app.TimeSortAsc()}).catch(function(e){console.log(e)})},tgtitemDeleteFile:function(e){axios.post("/storageManager/delete-file",{level:this.edittgtitem.ind,stuff:this.edittgtitem,rmid:e,file:this.edittgtitem.files[e],warehs:this.CurWarehouse,baseInd:this.baseInd}).then(function(t){app.edittgtitem.files.splice(e,1)})},initEditFileInfo:function(){this.fileUploaded=!1,this.edittgtfile=["","","","attachment"],this.uploadPercentCompleted=0,this.$bvModal.show("editFileInfo")},uploadFile:function(e){var t=new FormData;if(console.log(e),e){var a=e.type.split("/").pop();"text/plain"==e.type&&(a="txt"),"video/x-msvideo"==e.type&&(a="avi"),"application/octet-stream"==e.type&&(a="bin"),"application/msword"==e.type&&(a="doc"),"application/vnd.openxmlformats-officedocument.wordprocessingml.document"==e.type&&(a="docx"),"application/epub+zip"==e.type&&(a="epub"),"audio/mpeg"==e.type&&(a="mp3"),"application/vnd.ms-powerpoint"==e.type&&(a="ppt"),"application/vnd.openxmlformats-officedocument.presentationml.presentation"==e.type&&(a="pptx"),"application/vnd.rar"==e.type&&(a="rar"),"application/vnd.ms-excel"==e.type&&(a="xls"),"application/vnd.openxmlformats-officedocument.spreadsheetml.sheet"==e.type&&(a="xlsx"),t.append("file",e);let i=new Date,s=-i.getTimezoneOffset()/60;var n=new Date;n.setHours(n.getHours()+s);var o=n.toISOString();this.edittgtfile[0]="Clipboard File "+o.slice(0,10)+" "+o.slice(11,19)+"."+a}else tgtfile=document.getElementById("uploadFilePortal").files[0],this.edittgtfile[0]=tgtfile.name,t.append("file",tgtfile);var i={onUploadProgress:function(e){app.uploadPercentCompleted=e.loaded/e.total},cancelToken:new axios.CancelToken(function(e){cancelUploadFunc=e})};axios.put("/storageManager/upload-file",t,i).then(function(e){var t=e.data;app.edittgtfile[2]=t,app.fileUploaded=!0}).catch(function(e){throw console.log(e.message),e})},cancelEditFileInfoIfUploaded:function(){0!=app.uploadPercentCompleted&&(cancelUploadFunc(),axios.post("/storageManager/cancel-upload-file",{proposedfile:this.edittgtfile[2]}).then(function(e){window.alert("成功退出，请注意退出后文件无法保留，需重新上传文件。"),console.log("取消成功")}))},saveEditFileInfo:function(){axios.post("/storageManager/confirm-upload-file",{level:this.edittgtitem.ind,stuff:this.edittgtitem,proposedfile:this.edittgtfile,warehs:this.CurWarehouse,baseInd:this.baseInd}).then(function(e){app.edittgtitem.files.push(JSON.parse(JSON.stringify(app.edittgtfile))),app.uploadPercentCompleted=0,app.$bvModal.hide("editFileInfo")})},getfile:function(e){window.open(encodeURI("/storageManager/get-file?dlname="+e[0]+"&path="+e[2]))},generateThumbnail:function(e){文件后缀=e[0].substring(e[0].lastIndexOf(".")),文件名=e[0].substring(0,e[0].lastIndexOf(".")),""==文件名&&(文件名=e[0]),this.edittgtfile=["缩略图 of "+文件名+".jpg","","","thumbnail"],(-1!=[".png",".jpg",".jpeg",".svg",".tiff",".bmp",".gif"].indexOf(文件后缀)||window.confirm("不是图片文件！确认要继续吗？"))&&axios({url:encodeURI("/storageManager/get-file?dlname="+e[0]+"&path="+e[2]),method:"GET",responseType:"blob"}).then(e=>{const t=new Blob([e.data]);var a=new FileReader,n=new Image,o=document.createElement("canvas"),i=o.getContext("2d");a.onload=function(e){n.onload=function(){var e=this.width,t=this.height,a=800,s=800,r=e,p=t;(e>a||t>s)&&(e/t>a/s?(r=a,p=Math.round(a*(t/e))):(p=s,r=Math.round(s*(e/t)))),o.width=r,o.height=p,i.clearRect(0,0,r,p),i.drawImage(n,0,0,r,p),o.toBlob(function(e){URL.createObjectURL(e);var t=new FormData;t.append("file",e),axios.put("/storageManager/upload-file",t).then(function(e){var t=e.data;app.edittgtfile[2]=t,axios.post("/storageManager/confirm-upload-file",{level:app.edittgtitem.ind,stuff:app.edittgtitem,proposedfile:app.edittgtfile,warehs:app.CurWarehouse,baseInd:app.baseInd}).then(function(e){app.edittgtitem.files.unshift(JSON.parse(JSON.stringify(app.edittgtfile)))})})},"image/jpeg")},n.src=e.target.result},a.readAsDataURL(t)})},previewImg:function(e){this.$bvModal.show("previewImgModal"),this.previewImgURL=encodeURI("/storageManager/get-file?dlname="+e[0]+"&path="+e[2])},changeDir:function(e){var t=[...app.baseInd,...e];"../"==e&&(t=[...app.baseInd].slice(0,app.baseInd.length-1)),"root"==e&&(t=[]),window.location=window.location.href.split("/").slice(0,4).join("/")+"/"+app.CurWarehouse+"/"+JSON.stringify(t)},copyItemLink:function(e){"ind"==e?(copyStringToClipboard(window.location.href.split("/").slice(0,4).join("/")+"/"+app.CurWarehouse+"/"+JSON.stringify([...app.baseInd,...app.edittgtitem.ind])),window.alert("已复制链接。请注意当您移动树结构时，这个链接指向的元素会变动，非永久链接。")):"stable"==e&&(copyStringToClipboard(window.location.href.split("/").slice(0,4).join("/")+"/"+app.CurWarehouse+"/"+JSON.stringify(app.edittgtitem.名称+"|"+app.edittgtitem.setup)),window.alert("已复制链接。请注意当您移动树结构时，这个链接指向的元素会变动，非永久链接。"))},addBatchSentences:function(){var e=this.batchSentences+"。";this.batchSentences="",e=e.replace("  "," ").replace("  "," ").replace("  "," ").replace("　","").replace("；","。").replace("……","…").replace("\n","").replace("。。","。").replace("！。","！").replace("？。","？").replace("…。","…").replace("；。","；"),console.log(e),e=e.replace(/([0-9a-zA-Z\.\n\!\?…\~？。｡！—] *)。/g,(e,t)=>t);const t=[...e.matchAll(new RegExp(".*?(｡|。|？|！|…|;|!|\\?|(No\\.(?=[^ a-z0-9]))|No\\. +(?=[^a-z])|\\. *$|\\!|\\! *$)","g"))];for(const e of t)e[0].replace("。","").length>1&&this.edittgtitem.句向量描述.push(e[0].replace(".。","."))},copyPasteMgmt:function(){this.$bvModal.show("copyPasteModal")},genCopyLink:function(){axios.post("/storageManager/gen-copy-link",{ind:this.edittgtitem.ind,wh:this.CurWarehouse}).then(function(e){resptext=e.data,copyStringToClipboard(resptext),window.alert("已将链接复制到您的剪贴板~")})},submitPasteLink:function(){axios.post("/storageManager/submit-paste-link",{ind:this.edittgtitem.ind,wh:this.CurWarehouse,auth:this.copyPaste1}).then(function(e){window.alert("已粘贴至本元素子树中~")})},editProgram:function(){const e=new Promise((e,t)=>{if(app.loadedJsLibs.hljs)e("foo");else{var a=document.createElement("link");a.rel="stylesheet",a.href="/static/仓储管理/style.css",document.getElementsByTagName("head")[0].appendChild(a),a.onload=function(){var t=document.createElement("script");t.type="text/javascript",t.src="/static/仓储管理/highlight.min.js",document.getElementsByTagName("head")[0].appendChild(t),t.onload=function(){var t=document.createElement("script");t.type="text/javascript",t.src="/static/仓储管理/mathematica.min.js",document.getElementsByTagName("head")[0].appendChild(t),t=document.createElement("script"),t.type="text/javascript",t.src="/static/仓储管理/applescript.min.js",document.getElementsByTagName("head")[0].appendChild(t),t=document.createElement("script"),t.type="text/javascript",t.src="/static/仓储管理/vba.min.js",document.getElementsByTagName("head")[0].appendChild(t),app.loadedJsLibs.hljs=!0,t.onload=function(){Vue.directive("highlightjs",{deep:!0,bind:function(e,t){let a=e.querySelectorAll("code");a.forEach(e=>{t.value&&(e.textContent=t.value),hljs.highlightBlock(e)})},componentUpdated:function(e,t){let a=e.querySelectorAll("code");a.forEach(e=>{t.value&&(e.textContent=t.value,hljs.highlightBlock(e))})}}),app.tmpProgType=app.edittgtitem.program[0],app.tmpProgText=app.edittgtitem.program[1],app.tmpProgText2=app.edittgtitem.program[2],app.tmpProgLang=app.edittgtitem.program[3],e("foo")}}}}});e.then(()=>{app.$bvModal.show("ProgramModal")})},editProgramShown:function(){hljs.highlightAll(),app.tmpProgTextRealtime=app.tmpProgText,app.tmpProgText2Realtime=app.tmpProgText2,app.renderProg()},changeProgType:function(e){console.log(app.edittgtitem.program[0],e),app.tmpProgText=app.tmpProgTextRealtime,app.tmpProgText2=app.tmpProgText2Realtime,window.confirm("您确定要换类型吗？之前的数据会丢失。")?("clip"==e&&(app.tmpProgLang="Language-Mathematica",app.tmpProgText='RandomInstance[\n GeometricScene[{a, b, c, d, e, f, g, h, i, j}, {Line[{a, b, c, d}], \n   Line[{d, e, f, g}], Line[{g, h, b, i}], Line[{i, c, e, j}], \n   Line[{j, f, h, a}], \n   PlanarAngle[{b, c, e}, "Counterclockwise"] == 100 [Degree], \n   PlanarAngle[{f, h, b}, "Counterclockwise"] == 110 [Degree], \n   PlanarAngle[{h, a, b}, "Counterclockwise"] == 35 [Degree]}], \n RandomSeeding -> 1234]'),"template"==e&&(app.tmpProgText="请输入文本模板~例如，{{公司名}}公司即将发行零息债券，面值{{faceValue}}，利率{{rate}}，期限{{year}}年\n  ∴则{{公司名}}零息债价格为{{price}}。",app.tmpProgText2='var app = new Vue({el: "#app",\ndata: { /*↓初始数据*/\n\n公司名: "神御中华",\nfaceValue: 1000,\nrate: 0.03,\nyear: 3,\nprice: 0\n\n},mounted() {/*↓加载后执行*/\n\nthis.price = this.faceValue/((1+this.rate)**this.year)\n\n},methods: {}\n});'),"bvapp"==e&&(app.tmpProgText='<h2>即时的HTML编辑器是伟大的！{{randnum}}</h2>\n<button @click="update()">生成新的随机数！</button>\n<div id="test" v-html="output"></div>',app.tmpProgText2='var app = new Vue({\n    el: "#app",\n    data: {\n      msg: "hello world",\n      randnum: 0,\n      output: ""\n    },\n    mounted() {\n      var output = "";\n      for (var i = 0; i < 3; i++) { output += "JavaScript的作品呢！<br>"; }\n      document.getElementById("test").innerHTML = output;\n    },\n    methods: {\n      update: function () {\n        this.randnum = Math.random();\n        this.output  = "";\n        for (var i = 0; i < Math.round(this.randnum*10); i++) { this.output  += "JavaScript的作品呢！<br>"; }\n      },\n    }\n  });'),"htmljs"==e&&(app.tmpProgText='<html lang="zh">\n<head>\n<meta charset="UTF-8">\n<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4.5.3/dist/css/bootstrap.min.css"\n  integrity="sha256-93wNFzm2GO3EoByj9rKZCwGjAJAwr0nujPaOgwUt8ZQ=" crossorigin="anonymous">\n<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-vue@2.21.2/dist/bootstrap-vue.min.css"\n  integrity="sha256-cAyk5KZc7P6j7j/uL7MOoN4PRsZYp+BN9yo03Y6Qk38=" crossorigin="anonymous">\n<style>*{font-family:"Sarasa Term SC";}body{white-space:pre-wrap}</style>\n</head>\n<body><div id="app"><!-- vue instance -->\n<h2>即时的HTML编辑器是伟大的！{{randnum}}</h2>\n<button @click="update()">生成新的随机数！</button>\n<div id="test" v-html="output"></div>\n<!-- vue instance end --></div></body>\n<script src="https://cdn.jsdelivr.net/npm/vue@2.6.14/dist/vue.min.js"\n  integrity="sha256-kXTEJcRFN330VirZFl6gj9+UM6gIKW195fYZeR3xDhc=" crossorigin="anonymous"></script>\n<script src="https://cdn.jsdelivr.net/npm/bootstrap-vue@2.21.2/dist/bootstrap-vue.min.js"\n  integrity="sha256-duDNIhfVrUK7HB/57nPLxN/j92aM3rhTUFzVI/H5ex8=" crossorigin="anonymous"></script>\n<script>\nvar app = new Vue({\n  el: "#app",\n  data: {\n    msg: "hello world",\n    randnum: 0,\n    output: ""\n  },\n  mounted() {\n    var output = "";\n    for (var i = 0; i < 3; i++) { output += "JavaScript的作品呢！<br>"; }\n    document.getElementById("test").innerHTML = output;\n  },\n  methods: {\n    update: function () {\n      this.randnum = Math.random();\n      this.output  = "";\n      for (var i = 0; i < Math.round(this.randnum*10); i++) { this.output  += "JavaScript的作品呢！<br>"; }\n    },\n  }\n});\n</script>\n</html>'),app.tmpProgTextRealtime=app.tmpProgText,app.tmpProgText2Realtime=app.tmpProgText2,app.edittgtitem.program[0]=e,app.$forceUpdate(),setTimeout(()=>{app.renderProg()},300),hljs.highlightAll()):app.tmpProgType=app.edittgtitem.program[0]},renderProg:function(){本次input的时间=new Date,setTimeout(function(){var e,t;if((当前时间=new Date,当前时间-上次刷新的时间>499&&当前时间-本次input的时间>499)&&("template"==app.tmpProgType&&(e=前缀str+app.tmpProgTextRealtime.replace(/\\{/g,'{{ "\\{" }}').replace(/\\}/g,'{{ "\\}" }}')+中缀str+app.tmpProgText2Realtime.replace(/\\{/g,'{{ "\\{" }}').replace(/\\}/g,'{{ "\\}" }}')+后缀str,t=encodeURIComponent(e)),"bvapp"==app.tmpProgType&&(e=前缀str+app.tmpProgTextRealtime+中缀str+app.tmpProgText2Realtime+后缀str,t=encodeURIComponent(e)),"htmljs"==app.tmpProgType&&(t=encodeURIComponent(app.tmpProgTextRealtime)),"clip"!=app.tmpProgType)){var a=document.getElementById("ProgIframeView");a.style.height="700px",a.src="data:text/html,"+t,上次刷新的时间=new Date}},500)},saveProgram:function(e){"clip"==app.tmpProgType&&(this.tmpProgText=getProgText("#P1_ProgramClipCode"),this.tmpProgText2=""),"template"==app.tmpProgType&&(this.tmpProgText=getProgText("#P2_html"),this.tmpProgText2=getProgText("#P2_js")),"bvapp"==app.tmpProgType&&(this.tmpProgText=getProgText("#P3_html"),this.tmpProgText2=getProgText("#P3_js")),"htmljs"==app.tmpProgType&&(this.tmpProgText=getProgText("#P4_ProgramCode"),this.tmpProgText2=""),this.edittgtitem.program=[this.tmpProgType,this.tmpProgText,this.tmpProgText2,this.tmpProgLang],setTimeout(()=>{app.$bvModal.hide("ProgramModal"),app.saveedittgt()},200)},editRTF:function(){const e=new Promise((e,t)=>{if(app.loadedJsLibs.kindeditor)e("foo");else{var a=document.createElement("link");a.rel="stylesheet",a.href="/editor/themes/default/default.css",document.getElementsByTagName("head")[0].appendChild(a),a.onload=function(){var t=document.createElement("script");t.type="text/javascript",t.src="/editor/kindeditor-all-min.js",document.getElementsByTagName("head")[0].appendChild(t),app.loadedJsLibs.kindeditor=!0,t.onload=function(){var t=document.createElement("script");t.type="text/javascript",t.src="/editor/lang/zh-CN.js",document.getElementsByTagName("head")[0].appendChild(t),app.loadedJsLibs.kindeditor=!0,t.onload=function(){e("foo")}}}}});e.then(()=>{app.$bvModal.show("RTFModal")})},editRTFShown:function(){KindEditor.options.filterMode=!1,editor=KindEditor.create("#editor_id"),document.querySelector("#RTFModal___BV_modal_body_ > div").style.width="100%",document.querySelector("#RTFModal___BV_modal_body_ > div > div.ke-edit").style.height="800px",document.querySelector("#RTFModal___BV_modal_body_ > div > div.ke-edit > iframe").style.height="800px",document.querySelector("#RTFModal___BV_modal_body_ > div > div.ke-edit > textarea").style.height="798px",this.editorText="",this.edittgtitem.rtf&&(this.editorText=this.edittgtitem.rtf),editor.html(this.editorText)},saveRTF:function(e){this.ConfirmText="请问是否要把纯文本的rtf放到简介描述中呢~ 是选确认or直接点击背景关闭modal；否选取消。（会覆盖。但不用担心误操作，您原先的描述文本会被复制到剪贴板。）",this.$bvModal.show("ConfirmModal");var t=new Promise((e,t)=>{app.ConfirmPromiseResolve=e});t.then(()=>{app.ConfirmResult&&(copyStringToClipboard(app.edittgtitem.描述),app.edittgtitem.描述=editor.text().replace(/\t+/g,"").replace(/\n+/g,"\n")),app.editorText=editor.html(),app.edittgtitem.rtf=app.editorText,setTimeout(()=>{app.$bvModal.hide("RTFModal"),app.saveedittgt()},200)})},simpleExample:function(){""==this.query_txt?this.query_txt="[<洗发露>]+[<飘柔>]*0.5+[<清爽>]*0.3":window.confirm("您的搜索栏中有文字。继续操作将清空您之前输入的内容。真的要继续吗？")&&(this.query_txt="[<洗发露>]+[<飘柔>]*0.5+[<清爽>]*0.3")},rebuildNGT:function(){this.isQueryingBackend=!0,axios.post("/storageManager/rebuildNGT",{warehs:this.CurWarehouse}).then(function(e){app.$bvToast.toast("已重构搜索数据结构，请重试搜索~",{title:"已rebuild NGT~",appendToast:!0,variant:"info",solid:!0,toaster:"b-toaster-bottom-right"}),app.isQueryingBackend=!1}).catch(function(e){console.log(e)})},rebuildNGTReloadVec:function(){this.isQueryingBackend=!0,axios.post("/storageManager/rebuildNGTReloadVec",{warehs:this.CurWarehouse}).then(function(e){app.$bvToast.toast("已重构搜索数据结构ReloadVec，请重试搜索~",{title:"已rebuild NGT~",appendToast:!0,variant:"info",solid:!0,toaster:"b-toaster-bottom-right"}),app.isQueryingBackend=!1}).catch(function(e){console.log(e)})},searchSubtree:function(tgt){if(0==isLoading){if(this.query_txt.length>300)return void window.alert("QUERY TOO LONG!!");if(0==this.query_txt.length)return void window.alert("您尚未输入搜索字符串！");isLoading=!0,this.isQueryingBackend=!0,setTimeout(()=>{isLoading=!1},2e3),axios.post("/storageManager/query-subtree",{query:this.query_txt,tgt:tgt,resnumber:this.resnumber,warehs:this.CurWarehouse,baseInd:this.baseInd}).then(function(response){if(app.page_history<2&&window.history.pushState({page:app.page_history},"",""),app.page_history=Math.min(app.page_history+1,2),resptext=response.data,"nope"==resptext)return window.alert("您尚未登录哟~"),void(app.isQueryingBackend=!1);tmpobj=eval(resptext),founderr=!1,tmpobj.forEach(e=>{if("notfound"==e&&!founderr)return founderr=!0,window.alert("后端搜索出错！已经帮助您重新搭建搜索NGT结构了~ 请您刷新页面，稍等再试！"),app.isQueryingBackend=!1,void app.rebuildNGT()}),app.search_result=tmpobj,
app.show_search_result_mode=!0,app.isQueryingBackend=!1,setTimeout(()=>{window.scrollTo(0,0)},270)}).catch(function(e){console.log(e),app.isQueryingBackend=!1})}else console.log("TOO MANY CLICKS!!"),window.alert("搜索过于频繁!!!仔细等结果2秒啊。")},GetTodayStr:function(){var e=new Date;currentTimeZoneOffsetInHours=-e.getTimezoneOffset()/60;var t=new Date;t.setHours(t.getHours()+currentTimeZoneOffsetInHours);var a=t.toISOString().slice(0,10),n=a.split("-").map(Math.abs);return n[0]+"年"+n[1]+"月"+n[2]+"日 "+this.weekDayMap[t.getDay()]},GetDateDescription:function(e){try{var t=new Date;currentTimeZoneOffsetInHours=-t.getTimezoneOffset()/60;var a=new Date;a.setHours(a.getHours()+currentTimeZoneOffsetInHours);var n=a.toISOString(),o="",i=e.截止日期.split("-");return i&&i[0]!=n.slice(0,4)&&(o=e.截止日期.split("-")[0]+"年"),e.截止日期==n.slice(0,10)&&(o="今天 "+o),e.截止日期<n.slice(0,10)&&(o="已过期 "+o),o+e.截止日期.split("-").slice(1).map(Math.abs).join("月")+"日 "+this.weekDayMap[new Date(e.截止日期).getDay()]}catch(e){return"未知日期"}},timeMgmtClick:function(e){if(console.log("edittarget",e),0!=e.length){target=app.fullitems;for(const t of e.slice(0,-1))target=target[t].内容;this.edittgtitem=target[e[e.length-1]];var t=this.edittgtitem;if(t.重复数<=0)this.deleteitems(e);else{var a=new Date;currentTimeZoneOffsetInHours=-a.getTimezoneOffset()/60;var n=new Date(t.截止日期+" "+t.截止时间);"日"==t.重复间隔&&n.setDate(n.getDate()+parseInt(t.重复数)),"周"==t.重复间隔&&n.setDate(n.getDate()+7*parseInt(t.重复数)),"月"==t.重复间隔&&n.setMonth(n.getMonth()+parseInt(t.重复数)),"季度"==t.重复间隔&&n.setMonth(n.getMonth()+3*parseInt(t.重复数)),"年"==t.重复间隔&&n.setFullYear(n.getFullYear()+parseInt(t.重复数)),"小时"==t.重复间隔&&n.setHours(n.getHours()+parseInt(t.重复数)),n.setHours(n.getHours()+currentTimeZoneOffsetInHours);var o=n.toISOString();t.截止日期=o.slice(0,10),t.截止时间=o.slice(11,16),axios.post("/storageManager/save-items",{level:t.ind,stuff:t,warehs:this.CurWarehouse,baseInd:this.baseInd}).then(function(e){resptext=e.data,console.log(resptext);var t=new Date;t.setHours(t.getHours()+currentTimeZoneOffsetInHours);var a=t.toISOString();app.edittgtitem.modify=a.slice(0,10)+" "+a.slice(11,19),app.$bvToast.toast("已保存位于程序数据结构["+app.edittgtitem.ind+"]处的信息~",{title:"已保存~",autoHideDelay:2500,appendToast:!0,variant:"info",solid:!0,toaster:"b-toaster-bottom-right"}),1==app.edittgtitem.ind.length&&app.isTimeManagement&&app.TimeSortAsc()}).catch(function(e){console.log(e)})}}else this.edittgtitem=this.fullitems},dateClass(e,t){t.getDate();if(daysMap.has(e))return 1==daysMap.get(e)?"table-success":2==daysMap.get(e)?"table-primary":3==daysMap.get(e)?"table-warning":daysMap.get(e)>3?"table-danger":""},TimeSortAsc:function(){app.finishedTimeAsc=!1,app.fullitems.length<=1&&(app.finishedTimeAsc=!0),app.$forceUpdate(),daysMap=new Map;var 原现ind记录=[];for(let e=0;e<app.fullitems.length;e++){var ddl=app.fullitems[e].截止日期;daysMap.has(ddl)?daysMap.set(ddl,daysMap.get(ddl)+1):daysMap.set(ddl,1),原现ind记录.push({"后端初始ind":e,"截止日期":ddl,"截止时间":app.fullitems[e].截止时间})}var 原ind复制=[...原现ind记录];原现ind记录.sort(function(e,t){try{return new Date(e.截止日期+" "+e.截止时间)-new Date(t.截止日期+" "+t.截止时间)}catch(e){return 0}});for(let e=0;e<原现ind记录.length;e++)原现ind记录[e].后端目标ind=e;console.log("更新顺序");var action=i=>{const myPromise=new Promise((resolve,reject)=>{let 目前移动到的ind=i.i;i.i=i.i+1;for(let e=目前移动到的ind;e<原ind复制.length;e++){var element=原ind复制[e];if(element.后端目标ind==目前移动到的ind){srci=e,tgti=element.后端目标ind;break}}srci==tgti+1&&(srci=tgti,tgti=原ind复制[tgti].后端目标ind),srcitem=原ind复制.splice(srci,1),原ind复制.splice(tgti,0,srcitem[0]),srci!=tgti?axios.post("/storageManager/move-items",{src:[srci],tgt:[tgti],warehs:app.CurWarehouse,baseInd:app.baseInd}).then(function(response){resptext=response.data,resvals=eval(resptext),app.fullitems=resvals[0],i.i==原现ind记录.length-1&&(app.finishedTimeAsc=!0),app.$forceUpdate(),resolve(i)}).catch(function(e){console.log(e),window.alert("获取后端信息出错，为了保证数据结构不受损害，请刷新页面！！")}):(i.i==原现ind记录.length-1&&(app.finishedTimeAsc=!0),resolve(i))});return myPromise};const promiseFor=(e,t)=>{var a=e=>e.i<t?action(e).then(a):Promise.resolve(e);return a(e)};i={i:0},promiseFor(i,原现ind记录.length).then(console.log("finish."))}}});document.addEventListener("keydown",function(e){13!==e.keyCode||app.entershoulddefault&&!e.shiftKey||(e.preventDefault(),app.searchSubtree([])),112===e.keyCode&&(e.preventDefault(),app.executeCmdCommand()),113===e.keyCode&&(app.consoleCmd="",document.getElementById("cmdcommand").focus()),114===e.keyCode&&document.getElementById("mainsearchbox").focus()}),document.onpaste=(e=>{const t=e.clipboardData||window.clipboardData,a=t.files[0];a&&app.uploadFile(a)}),window.addEventListener("beforeunload",function(e){reload_upload_focus_flip&&(reload_upload_focus_flip=!1)}),window.onpopstate=function(e){console.log(e),2==app.page_history?(app.page_history=1,app.show_search_result_mode=!1,app.$bvToast.toast("本网站回退功能并不完善，如果多次搜索，会导致之前的搜索结果丢失，无法通过历史浏览记录复原。 因此请注意保存结果！          您上一次搜索的内容可以通过点击前进按钮恢复。",{title:"⚠️请注意保存结果！",autoHideDelay:1e4,appendToast:!0,variant:"danger",solid:!0,toaster:"b-toaster-bottom-right"})):(app.page_history=2,app.show_search_result_mode=!0)};